{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="card">
    <div class="card-body">
      <button type="button"
              class="btn-close float-end"
              aria-label="Close"
              onclick="window.history.back()"></button>

      <h3 class="card-title">PERC Rule</h3>
      <p class="text-muted small">
        Apply only if overall pre-test probability is already low. If <strong>all</strong> are negative,
        PE may be ruled out clinically in some pathways.
      </p>

      <form method="post">
        {% set items = [
          ('age_ge_50', 'Age ≥ 50'),
          ('hr_ge_100', 'Heart rate ≥ 100 bpm'),
          ('sat_lt_95', 'O₂ saturation on room air &lt; 95%'),
          ('unilateral_swelling', 'Unilateral leg swelling'),
          ('haemoptysis', 'Haemoptysis'),
          ('recent_surgery', 'Recent surgery/trauma (&lt; 4 weeks)'),
          ('prior_vte', 'Prior DVT/PE'),
          ('oestrogen', 'Oestrogen use')
        ] %}
        {% for key, label in items %}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="{{ key }}" id="{{ key }}">
            <label class="form-check-label" for="{{ key }}">{{ label }}</label>
          </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary mt-3">Apply PERC</button>
      </form>

      {% if positive is defined %}
        <hr>
        <h5>Result</h5>
        <p class="fs-6 mb-1">Number of positive PERC items: <strong>{{ positive }}</strong> / 8</p>
        {% if perc_negative %}
          <p class="text-success small mb-0">
            PERC negative (0/8) – in low-risk patients this may support no further PE testing,
            depending on local policy.
          </p>
        {% else %}
          <p class="text-warning small mb-0">
            PERC positive – further investigation usually required according to PE pathway.
          </p>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
